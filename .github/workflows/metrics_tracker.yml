name: Daily Publication Metrics

on:
  schedule:
    # 毎日 UTC 17:00 (日本時間 翌02:00 / 米国PST 09:00頃) に実行
    - cron: '0 17 * * *'
  workflow_dispatch: # 手動実行ボタンも有効化

jobs:
  track-metrics:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout repository
      uses: actions/checkout@v3

    - name: Set up Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.10'

    - name: Install Dependencies
      run: |
        pip install requests pandas plotly beautifulsoup4 textblob googletrans==4.0.0-rc1 langdetect lxml tqdm googlesearch-python pytz tabulate slack_sdk kaleido==0.2.1

    - name: Run Tracker Script
      env:
        SLACK_BOT_TOKEN: ${{ secrets.SLACK_BOT_TOKEN }}
        SLACK_CHANNEL_ID: ${{ secrets.SLACK_CHANNEL_ID }}
      run: |
        python publication_tracker.py
